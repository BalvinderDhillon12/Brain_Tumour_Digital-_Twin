import pandas as pd
import numpy as np
import torch
from sklearn.preprocessing import StandardScaler

# 1. Load the original raw dataset
df_raw = pd.read_csv("/content/drive/MyDrive/hackathon_output/RADIOMICS_SELECTED_CASES.csv")

# 2. Identify the 87 'PRED' features
raw_feature_cols = [col for col in df_raw.columns if col.startswith('PRED_')]

# 3. Standardize the Raw Data
# This is CRITICAL for raw data; otherwise, the agent will ignore small-scale features
scaler_raw = StandardScaler()
df_raw_scaled = df_raw.copy()
df_raw_scaled[raw_feature_cols] = scaler_raw.fit_transform(df_raw[raw_feature_cols])

# 4. Create the Raw Digital Twin Database
raw_patient_db = {}
for _, row in df_raw_scaled.iterrows():
    p_id = row['Case']
    # The state is the 87 features
    raw_patient_db[p_id] = {
        "initial_state": row[raw_feature_cols].values.astype(np.float32),
        "feature_names": raw_feature_cols
    }

print(f"Initialized Raw Digital States with {len(raw_feature_cols)} features for each patient.")
